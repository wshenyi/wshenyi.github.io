<!DOCTYPE html>
<html lang="">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon_32x32.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon_16x16.ico">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"wshenyi.github.io","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","width":300,"display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="Godway&#39;s Notebook">
<meta property="og:url" content="https://wshenyi.github.io/page/2/index.html">
<meta property="og:site_name" content="Godway&#39;s Notebook">
<meta property="og:locale">
<meta property="article:author" content="Godway">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://wshenyi.github.io/page/2/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'default'
  };
</script>

  <title>Godway's Notebook</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Godway's Notebook</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">wsy</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="user fa-fw"></i>About</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

  <a href="https://github.com/WSHENYI/WSHENYI.github.io" class="github-corner" title="Star me on GitHub" aria-label="Star me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="">
    <link itemprop="mainEntityOfPage" href="https://wshenyi.github.io/2022/02/05/MC2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.ico">
      <meta itemprop="name" content="Godway">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Godway's Notebook">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/02/05/MC2/" class="post-title-link" itemprop="url">A Primer on Memory Consistency and Cache Coherence, 2nd [Ch.3 - Ch.5]</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-02-05 18:14:52" itemprop="dateCreated datePublished" datetime="2022-02-05T18:14:52-05:00">2022-02-05</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-04-24 10:39:36" itemprop="dateModified" datetime="2022-04-24T10:39:36-04:00">2022-04-24</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Memory-Consistency/" itemprop="url" rel="index"><span itemprop="name">Memory Consistency</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><em><strong>Keywards</strong></em> computer architecture, memory consistency, cache coherence, shared memory, memory systems, multicore processor, heterogeneous architecture, GPU, accelerators, semantics, verification</p>
<blockquote>
<p>Author: Vijay Nagarajan, Daniel J. Sorin, Mark D. Hill, David A. Wood</p>
</blockquote>
<hr>
<h2 id="Chapter-3-Memory-Consistency-Motivation-and-Sequential-Consistency"><a href="#Chapter-3-Memory-Consistency-Motivation-and-Sequential-Consistency" class="headerlink" title="Chapter 3: Memory Consistency - Motivation and Sequential Consistency"></a>Chapter 3: Memory Consistency - Motivation and Sequential Consistency</h2><h3 id="Memory-Consistency-Model"><a href="#Memory-Consistency-Model" class="headerlink" title="Memory Consistency Model"></a>Memory Consistency Model</h3><p>store-load reordering arise due to out-of-order execution or due to local bypassing in the commonly implemented FIFO write buffer, even with a core that executes all instructions in program order.</p>
<p>A <strong>memory consistency model</strong>, (or <strong>memory model</strong>) is a specification of the allowed behavior of multithreaded programs executing with shared memory. For a specific input data, it specifies what values dynamic loads may return. Unlike single-theaded execution, multiple correct behaviors are usually allowed.</p>
<h3 id="Consistency-vs-Coherence"><a href="#Consistency-vs-Coherence" class="headerlink" title="Consistency vs. Coherence"></a>Consistency vs. Coherence</h3><p>Cache coherence protocol simply provides the processor core pipeline an <em>abstration</em> of a memory system. Coherence alone cannot determine shared memory behavior; the pipeline matters too.</p>
<p>In summary:</p>
<ol>
<li>Cache coherence does not equal memory consistency.</li>
<li>A memory consistency implementation can use cache coherence as a useful “black box”.</li>
</ol>
<img src="/2022/02/05/MC2/1.png" class="">

<h3 id="SC-Formalism"><a href="#SC-Formalism" class="headerlink" title="SC Formalism"></a>SC Formalism</h3><p>An <strong>SC execution</strong> requires:</p>
<ol>
<li>All cores insert their loads and stores into the memory order respecting their program order, regardless of whether they are to the same or different addresses<ul>
<li>$Load \rightarrow Load$</li>
<li>$Load \rightarrow Store$</li>
<li>$Store \rightarrow Load$</li>
<li>$Store \rightarrow Store$</li>
</ul>
</li>
<li>Every loads gets its value <em>from</em> the last store before it (in global memory order) <em>to</em> the same address.</li>
</ol>
<img src="/2022/02/05/MC2/3.png" class="">

<p>(from Wiki) A device that executes instructions described by that ISA, such as a CPU, is called an <strong>implementation</strong>.</p>
<p>An <strong>SC implementation</strong> permits only SC executions. Strictly speaking, this is the <em>safety</em> property for SC implementations (do no harm). SC implementations should also have some <em>liveness</em> properties (do some good). Specifically, a store must become eventually visible to a load that is repeatedly attempting to load that location. This property, referred to as eventual write- propagation, is typically ensured by the coherence protocol.</p>
<h3 id="Navie-SC-Implimentations"><a href="#Navie-SC-Implimentations" class="headerlink" title="Navie SC Implimentations"></a>Navie SC Implimentations</h3><p>Operational models</p>
<ul>
<li>The Multitasking Uniprocessor</li>
<li>The Switch</li>
</ul>
<h3 id="A-Basic-SC-Implementation-with-Cache-Coherence"><a href="#A-Basic-SC-Implementation-with-Cache-Coherence" class="headerlink" title="A Basic SC Implementation with Cache Coherence"></a>A Basic SC Implementation with Cache Coherence</h3><img src="/2022/02/05/MC2/2.png" class="">

<h3 id="Optimized-SC-Implimentations-with-Cache-Coherence"><a href="#Optimized-SC-Implimentations-with-Cache-Coherence" class="headerlink" title="Optimized SC Implimentations with Cache Coherence"></a>Optimized SC Implimentations with Cache Coherence</h3><h4 id="Non-Binding-Prefetching"><a href="#Non-Binding-Prefetching" class="headerlink" title="Non-Binding Prefetching"></a>Non-Binding Prefetching</h4><p>Prefetching has two types:</p>
<ul>
<li><strong>binding prefetching</strong>: Prefetch into a register (using a regular load)</li>
<li><strong>non-binding prefetching</strong>: Prefetch into cache. (non-binding prefetches do not affect the memory consistency model)</li>
</ul>
<h4 id="Speculative-Cores"><a href="#Speculative-Cores" class="headerlink" title="Speculative Cores"></a>Speculative Cores</h4><p>For speculative cores, the squashed loads and stores due to branch mis-prediction can be made to look like non-binding prefetches, enabling this speculation to be correct because it has no effect on SC. But the cache does not undo non-binding prefetches, as doing so is not necessary and prefetching the block can help performance if the load gets re-executed.</p>
<h4 id="Dynamically-Scheduled-Cores"><a href="#Dynamically-Scheduled-Cores" class="headerlink" title="Dynamically Scheduled Cores"></a>Dynamically Scheduled Cores</h4><p>Speculating on SC requires that the core verify that the prediction is correct. Here are two techniques for performing this check. First, after the core speculatively executes a load event, but before it commits it, the core could check that the speculatively accessed block has not left the cache. The second checking technique is to replay each speculative load when the core is ready to commit the load</p>
<h4 id="Non-Binding-Prefetching-in-Dynamically-Scheduled-Cores"><a href="#Non-Binding-Prefetching-in-Dynamically-Scheduled-Cores" class="headerlink" title="Non-Binding Prefetching in Dynamically Scheduled Cores"></a>Non-Binding Prefetching in Dynamically Scheduled Cores</h4><p>In summary, SC is not affected by the order of non-binding prefetches.</p>
<ul>
<li>SC requires only that a core’s loads and stores (appear to) access its L1 cache in program order.</li>
<li>Coherence requires the L1 cache blocks to be in the appropriate states to receive loads and stores.</li>
</ul>
<p><strong>SC dictates the order in which loads and stores (appear to) get applied to coherent memory but does NOT dictate the order of coherence activity</strong>.</p>
<h3 id="Atomic-Operations-with-SC"><a href="#Atomic-Operations-with-SC" class="headerlink" title="Atomic Operations with SC"></a>Atomic Operations with SC</h3><p>Implementing atomic instructions in the microarchitecture is conceptually straightforward, but naive designs can lead to poor performance for atomic instructions.</p>
<p>More aggressive implementations of RMWs leverage the insight that SC requires only the appearance of a total order of all requests. The core needs to only load and store the block in its cache — without any coherence messages or bus locking — as long as it waits to service any incoming coherence request for the block until after the store.</p>
<h2 id="Chapter-4-Total-Store-Order-and-the-x86-Memory-Model"><a href="#Chapter-4-Total-Store-Order-and-the-x86-Memory-Model" class="headerlink" title="Chapter 4: Total Store Order and the x86 Memory Model"></a>Chapter 4: Total Store Order and the x86 Memory Model</h2><h3 id="Motivation-For-TSO-x86"><a href="#Motivation-For-TSO-x86" class="headerlink" title="Motivation For TSO/x86"></a>Motivation For TSO/x86</h3><p>Processor cores have long used <em>write (store) buffers</em> to hold committed (retired) stores until the rest of the memory system could process the stores. </p>
<p>Significantly, a store can enter the write buffer before the cache has obtained read-write coherence permissions for the block to bewritten; the write buffer thus hides the latency ofservicing a store miss.</p>
<h3 id="Basic-Idea-of-TSO-x86"><a href="#Basic-Idea-of-TSO-x86" class="headerlink" title="Basic Idea of TSO/x86"></a>Basic Idea of TSO/x86</h3><p>Omitting $Store \rightarrow Load$ constraint allows each core to use a write buffer. Note that the constraint $Store \rightarrow Store$ means that the write buffer must be FIFO (and not, for example, coalescing) to preserve store-store order.</p>
<h3 id="TSO-x86-Formalism"><a href="#TSO-x86-Formalism" class="headerlink" title="TSO/x86 Formalism"></a>TSO/x86 Formalism</h3><p>A <strong>TSO</strong> execution requires the following.</p>
<ol>
<li>All cores insert their loads and stores into the memory order respecting their program order, regardless of whether they are to the same or different addresses.<ul>
<li>$Load \rightarrow Load$</li>
<li>$Load \rightarrow Store$</li>
<li>$Store \rightarrow Store$</li>
</ul>
</li>
<li>Every loads gets its value <em>from</em> the last store before it (in global memory order) <em>to</em> the same address.</li>
<li>Fences order everything<ul>
<li>$Store \rightarrow Fence$</li>
<li>$Fence \rightarrow Load$</li>
</ul>
</li>
</ol>
<img src="/2022/02/05/MC2/4.png" class="">  

<h3 id="Implementing-TSO-x86"><a href="#Implementing-TSO-x86" class="headerlink" title="Implementing TSO/x86"></a>Implementing TSO/x86</h3><img src="/2022/02/05/MC2/6.png" class="">

<h3 id="Implementing-Atomic-Instructions"><a href="#Implementing-Atomic-Instructions" class="headerlink" title="Implementing Atomic Instructions"></a>Implementing Atomic Instructions</h3><p>The key difference for RMW instructions is that TSO allows loads to pass earlier stores that have been written to a write buffer. The impact on RMW is that the store may be written to the write buffer.</p>
<p>A simple implementation:</p>
<ul>
<li>The load part of the RMW cannot pass an earlier store because (1) RMW is an atomic pair and (2) if the load part pass then the store part also have to pass, which is forbidden by $Store \rightarrow Store$ constraint.</li>
<li>Since the load part of the RMW cannot be performed until earlier stores have been exited the write buffer, the atomic RMW effectively <strong>drain</strong> the write buffer before it can perform the load part of the RMW.</li>
<li>Furthermore, to ensure that the store part can be ordered immediately after the load part, the load part requires read-write permissions (state of <strong>Modified</strong> in cache coherence). \</li>
<li>Lastly, to guarantee atomicity for the RMW, the cache controller may not relinquish this read-write coherence permission to the block between the load and the store.</li>
</ul>
<p>A more optimized implementation (the write buffer does not need to be drained):</p>
<ul>
<li>Every entry already in the write buffer has read-write permission in the cache and maintains the read-write permission in the cache until the RMW commits.</li>
<li>The core performs MIPS R10000-style checking of load speculation.</li>
</ul>
<h3 id="Implementing-Fences"><a href="#Implementing-Fences" class="headerlink" title="Implementing Fences"></a>Implementing Fences</h3><p>The semantics ofthe FENCE specify that all instructions before the FENCE in program order must be ordered before any instructions after the FENCE in program order.</p>
<p>A simple implementation -— such as draining the write buffer when a FENCE is executed and not permitting subsequent loads to execute until an earlier FENCE has committed—may provide acceptable performance.</p>
<h2 id="Chapter-5-Relaxed-Memory-Consistency"><a href="#Chapter-5-Relaxed-Memory-Consistency" class="headerlink" title="Chapter 5: Relaxed Memory Consistency"></a>Chapter 5: Relaxed Memory Consistency</h2><h3 id="Motivation"><a href="#Motivation" class="headerlink" title="Motivation"></a>Motivation</h3><p>If proper operation does not depend on ordering among many loads and stores, perhaps one could obtain higher performance by relaxing the order among them, since loads and stores are typically much more frequent than lock acquires and releases. This is what relaxed or weak models do.</p>
<p>A few common and important optimizations to exploit reordering:</p>
<ul>
<li>Non-FIFO, Coalescing Write Buffer</li>
<li>Simpler Support for Core Speculation</li>
<li>Coupling COnsistency and Coherence</li>
</ul>
<h3 id="XC-Formalism"><a href="#XC-Formalism" class="headerlink" title="XC Formalism"></a>XC Formalism</h3><p>For teaching purposes, this section introduces an <em>eXample relaxed Consistency model</em> (<strong>XC</strong>) that captures the basic idea and some implementation potential ofrelaxed memory consistency models.</p>
<p>A FENCE instruction does not specify an address. Two FENCEs by the same core also stay ordered. However, a FENCE does not affect the order of memory operations at other cores (which is why “fence” may be a better name than “barrier” which is often used as a software-level concept).</p>
<p>An XC execution requires the following:</p>
<ol>
<li>All cores insert their loads, stores, and FENCEs into the memory order respecting:<ul>
<li>$Store \rightarrow Fence$</li>
<li>$Load \rightarrow Fence$</li>
<li>$Fence \rightarrow Fence$</li>
<li>$Fence \rightarrow Load$</li>
<li>$Fence \rightarrow Store$</li>
</ul>
</li>
<li>All cores insert their loads and stores to the <em>same</em> address into the memory order respecting:<ul>
<li>$Load \rightarrow Load$ to the same address</li>
<li>$Load \rightarrow Store$ to the same address</li>
<li>$Store \rightarrow Load$ to the same address</li>
</ul>
</li>
<li>Every load gets its value from the last store before it to the same address</li>
</ol>
<img src="/2022/02/05/MC2/5.png" class="">

<h3 id="Implementing-XC"><a href="#Implementing-XC" class="headerlink" title="Implementing XC"></a>Implementing XC</h3><img src="/2022/02/05/MC2/7.png" class="">

<p>As before, cache coherence implements the global memory order. What is new is that memory order can more often disrespect program order due to reorder unit reorderings.</p>
<h3 id="Atomic-Instructions-with-XC"><a href="#Atomic-Instructions-with-XC" class="headerlink" title="Atomic Instructions with XC"></a>Atomic Instructions with XC</h3><p>Notably, not like RMW in TSO, XC allows both the load part and the store part of the RMW to pass earlier stores. Thus, it is sufficient to simply obtain read-write coherence permissions (M state) to the block and then perform the load part and the store part without relinquishing the block between those two operations.</p>
<p>One important difference between XC and TSO is how atomic RMWs are used to achieve synchronization. For the acquire, XC does not, by default, constrain the RMW from being reordered with respect to the operations in the critical section. To avoid this situation, a lock acquire must be followed by a FENCE. Similarly, the lock release is not, by default, constrained from being reordered with respect to the operations before it in the critical section. To avoid this situation, a lock release must be preceded by a FENCE.</p>
<img src="/2022/02/05/MC2/8.png" class="">

<h3 id="Fences-with-XC"><a href="#Fences-with-XC" class="headerlink" title="Fences with XC"></a>Fences with XC</h3><p>Three basic approaches:</p>
<ul>
<li>An implementation can implement SC and treat all FENCEs as no-ops. This is not done (yet) in a commercial product, but there have been academic proposals, e.g., via implicit transactional memory.</li>
<li>An implementation can wait for all memory operations Xi to perform, consider the FENCE done, and then begin memory operations Yi. This “FENCE as drain” method is common, but it makes FENCEs costly.</li>
<li>An implementation can aggressively push toward what is necessary, enforcing Xi $\rightarrow$ FENCE $\rightarrow$ Yi, without draining.</li>
</ul>
<p>In all cases, a FENCE implementation must know when each operation Xi is done (or at least ordered). Knowing when an operation is done can be especially tricky for a store that bypasses the usual cache coherence.</p>
<h3 id="SC-For-Data-Race-Free-DRF"><a href="#SC-For-Data-Race-Free-DRF" class="headerlink" title="SC For Data-Race-Free (DRF)"></a>SC For Data-Race-Free (DRF)</h3><p>SC for DRF programming</p>
<ul>
<li>asks program- mers to ensure programs are DRF under SC by writing correctly synchronized programs and labeling the synchronization operations.</li>
<li>it then asks implementors to ensure that all executions of DRF programs on the relaxed model are also SC executions by mapping the labeled synchronization operations to FENCEs and RMWs supported by the relaxed memory model.</li>
</ul>
<p>With FENCEs around synchronization operations (all synchronization operations are preceded and succeeded by FENCEs), XC supports SC for DRF programs.</p>
<p>In summary, a programmer using a relaxed memory system can reason about their program with two options:</p>
<ul>
<li>they can reason directly using the rules for what the model does and does not order.</li>
<li>they can insert sufficient synchronization to ensure no data races—synchronization races are still allowed—and reason about their program using the relatively simple model of sequential consistency that never appears to perform memory operations out of program order.</li>
</ul>
<h3 id="Some-Relaxed-Model-Concepts"><a href="#Some-Relaxed-Model-Concepts" class="headerlink" title="Some Relaxed Model Concepts"></a>Some Relaxed Model Concepts</h3><p><strong>Release Consistency</strong> (RC) thinks surrounding all synchronization operations with FENCEs is overkill. It claims that a synchronization acquire needs only a succeeding FENCE, while a synchronization release needs only a preceding FENCE.</p>
<p>Property <strong>causality</strong> requires that “If I see it and tell you about it, then you will see it too.”</p>
<p>Property <strong>write atomicity</strong> (also called <strong>store atomicity</strong> or <strong>multi-copy atomicity</strong>), requires that a core’s store is logically seen by all other cores at once. Write atomicity allows a core to see the value of its own store before it is seen by other cores.</p>
<p>Relations between causality and write atomicity:</p>
<ul>
<li>Write atomicity implies causality.</li>
<li>Causality does not imply write atomicity.</li>
</ul>
<p>Finally, the XC memory model is both store atomic and maintains causality.</p>
<h3 id="High-Level-Language-Models-HLL"><a href="#High-Level-Language-Models-HLL" class="headerlink" title="High-Level Language Models (HLL)"></a>High-Level Language Models (HLL)</h3><p>HLLs, such as Java and C++, adopt the relaxed memory model approach of “SC for DRF”. When these HLLs run on hardware, should the hardware’s memory model also be relaxed?</p>
<p>On one hand, (a) relaxed hardware can give the most performance, and (b) compilers and runtime software need only translate the HLL’s synchronizations operations into the particular hardware’s low-level synchronization operations and FENCEs to provide the necessary ordering.</p>
<p>On the other hand, (a) SC and TSO can give good performance, and (b) compilers and runtime software can generate more portable code without FENCEs from incomparable memory models. </p>
<p>Although the debate is not settled, it is clear that <strong>relaxed HLL models do not require relaxed hardware</strong>.</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="">
    <link itemprop="mainEntityOfPage" href="https://wshenyi.github.io/2022/02/04/MC1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.ico">
      <meta itemprop="name" content="Godway">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Godway's Notebook">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/02/04/MC1/" class="post-title-link" itemprop="url">A Primer on Memory Consistency and Cache Coherence, 2nd [Ch.1 - Ch.2]</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-02-04 18:35:35" itemprop="dateCreated datePublished" datetime="2022-02-04T18:35:35-05:00">2022-02-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-04-22 17:29:04" itemprop="dateModified" datetime="2022-04-22T17:29:04-04:00">2022-04-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Memory-Consistency/" itemprop="url" rel="index"><span itemprop="name">Memory Consistency</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><em><strong>Keywards</strong></em> computer architecture, memory consistency, cache coherence, shared memory, memory systems, multicore processor, heterogeneous architecture, GPU, accelerators, semantics, verification</p>
<blockquote>
<p>Author: Vijay Nagarajan, Daniel J. Sorin, Mark D. Hill, David A. Wood</p>
</blockquote>
<hr>
<h2 id="Chapter-1-Introduction-to-Consistency-and-Coherence"><a href="#Chapter-1-Introduction-to-Consistency-and-Coherence" class="headerlink" title="Chapter 1: Introduction to Consistency and Coherence"></a>Chapter 1: Introduction to Consistency and Coherence</h2><p>Consistency = memory consistency / memroy consistency model / memory model<br>Coherence = cache coherence</p>
<p>We need to define <strong>shared memory correctness</strong> —- that is, which shared memory behaviors are allowed -— so that programmers know what to expect and implementors know the limits to what they can provide.</p>
<p>Shared memory correctness is specified by a <strong>memory consistency model</strong> (MCM).</p>
<h2 id="Chapter-2-Coherence-Basics"><a href="#Chapter-2-Coherence-Basics" class="headerlink" title="Chapter 2: Coherence Basics"></a>Chapter 2: Coherence Basics</h2><h3 id="Baseline-System-Model"><a href="#Baseline-System-Model" class="headerlink" title="Baseline System Model"></a>Baseline System Model</h3><img src="/2022/02/04/MC1/1.png" class="">

<p>The <strong>last-level cache</strong> (LLC), depite being on the processor chip, is logically a “memory-side cache” and thus does not introduce another level of coherence issue. The LLC is logically just infront of the memory and serves to <em>reduce the average latency of memory accesses</em> and <em>increase the memory’s effective bandwidth</em>. The LLC also serve as <em>an on-chip memory controller</em>.</p>
<h3 id="Cache-Coherence-Interface"><a href="#Cache-Coherence-Interface" class="headerlink" title="Cache Coherence Interface"></a>Cache Coherence Interface</h3><p>Informally, a <strong>coherence protocol</strong> ensure that writes are made visible to all processors.</p>
<p>The processor cores interact with the <strong>coherence protocol</strong> throught a <strong>coherence interface</strong> that provides two methods: (1) a <em>read-request</em> method, and (2) a <em>write-request</em> method.</p>
<p>A pipeline-coherence interface.</p>
<img src="/2022/02/04/MC1/2.png" class="">

<p>Cache coherence protocols are classified into two categories based on the nature of their coherence interface:</p>
<ul>
<li><strong>Consistency-agnostic coherence</strong>: Writes are propagated <strong>synchronously</strong>. This category presents an interface that is identical to that of an atomic memroy system (with no cache).</li>
<li><strong>Consistency-directed coherence</strong>: Writes are propagated <strong>asynchronously</strong>. This category emerged to support throughput-based GPGPU. In order to correctly enforce consistency, coherence protocols in this class must ensure that the order in which writes are eventually made visible adheres to the ordering rules mandated by the consistency model.</li>
</ul>
<h3 id="Invariants-of-consistency-agnostic-Coherence"><a href="#Invariants-of-consistency-agnostic-Coherence" class="headerlink" title="Invariants of (consistency-agnostic) Coherence"></a>Invariants of (consistency-agnostic) Coherence</h3><ol>
<li><strong>Single-Writer, Multiple-Read (SWMR) Invariant</strong>. For any memory location A, at any given time, there exists only a single core that may write to A (and can also read it) or some number of cores that may only read A.</li>
<li><strong>Data-Value Invariant</strong>. Any read from a memory location must be the same value written by the last write to the that memory location.</li>
</ol>
<p>The vast majority of coherence protocols, called “invalidate protocols,” are designed explicitly to maintain these invariants.</p>
<p>In practice, coherence is usually maintained at the granularity of <strong>cache blocks</strong>. And one should be aware that there have been protocols that have maintained coherence at finer and coarser granularities.</p>
<p>Definitions of Coherence v.s. Consistency: coherence is specified on a <strong>per-memory location</strong> basis, whereas consistency is specified with respect to <strong>all memory locations</strong>.</p>
<p>Two key ideas when talk about coherence:</p>
<ul>
<li><strong>Coherence pertains to <em>all</em> storage structures that hold blocks from the shared address space.</strong></li>
<li><strong>Coherence is not <em>directly</em> visible to the programmer</strong>. On the other hand, the processor pipeline and coherence protocol jointly enforce the consistency model, and it is only the consistency model that is visible to the programmer.</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="">
    <link itemprop="mainEntityOfPage" href="https://wshenyi.github.io/2022/02/03/Arch6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.ico">
      <meta itemprop="name" content="Godway">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Godway's Notebook">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/02/03/Arch6/" class="post-title-link" itemprop="url">Computer Architecture - A Quantitative Approach, 6th [3.1 - 3.5]</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-02-03 18:34:19" itemprop="dateCreated datePublished" datetime="2022-02-03T18:34:19-05:00">2022-02-03</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-02-15 16:52:13" itemprop="dateModified" datetime="2022-02-15T16:52:13-05:00">2022-02-15</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Architecture/" itemprop="url" rel="index"><span itemprop="name">Architecture</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="">
    <link itemprop="mainEntityOfPage" href="https://wshenyi.github.io/2022/02/02/Arch5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.ico">
      <meta itemprop="name" content="Godway">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Godway's Notebook">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/02/02/Arch5/" class="post-title-link" itemprop="url">Computer Architecture - A Quantitative Approach, 6th [C.4 - C.7]</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-02-02 18:26:45" itemprop="dateCreated datePublished" datetime="2022-02-02T18:26:45-05:00">2022-02-02</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-02-18 15:02:17" itemprop="dateModified" datetime="2022-02-18T15:02:17-05:00">2022-02-18</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Architecture/" itemprop="url" rel="index"><span itemprop="name">Architecture</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="">
    <link itemprop="mainEntityOfPage" href="https://wshenyi.github.io/2022/01/31/R28/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.ico">
      <meta itemprop="name" content="Godway">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Godway's Notebook">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/01/31/R28/" class="post-title-link" itemprop="url">028 "Speculative Lock Elision - Enabling Highly Concurrent Multithreaded Execution"</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-01-31 09:50:19" itemprop="dateCreated datePublished" datetime="2022-01-31T09:50:19-05:00">2022-01-31</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-02-13 17:20:11" itemprop="dateModified" datetime="2022-02-13T17:20:11-05:00">2022-02-13</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Reviews/" itemprop="url" rel="index"><span itemprop="name">Reviews</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><em><strong>Keywards</strong></em> transactional memory， parallel computing</p>
<blockquote>
<p>Author:</p>
</blockquote>
<hr>
<h2 id="What-is-the-Problem"><a href="#What-is-the-Problem" class="headerlink" title="What is the Problem?"></a>What is the Problem?</h2><p>Serialization of threads due to critical sections is a fundamental bottleneck to achieving high performance in multithreaded programs. Dynamically, such serialization may be unnecessary because these critical sections could have safely executed concurrently without locks. Current processors cannot fully exploit such parallelism because they do not have mechanisms to dynamically detect such false inter-thread dependences.</p>
<h2 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h2><p>Locks do not always have to be acquired for a correct execution and in such situations concurrency can further improve by removing unnecessary locks.  The authors proposed Speculative Lock Elision (SLE) which can remove dynamically unnecessary lock-induced serilization and enable highly concurrent multithreaded execution.</p>
<h2 id="Background"><a href="#Background" class="headerlink" title="Background"></a>Background</h2><p>Trade-off in multithread programming:</p>
<ul>
<li>Conservtive locking: To ensure correctness at the expense of performance.</li>
<li>Locking granularity: Finer granularity locking can improve performance but introduces programming complexity and makes program management difficult.</li>
<li>Thread-unsafe legacy libraries: if a library not equipped to deal with threads, a global locking is introduced and thus degrade performance.</li>
</ul>
<h2 id="Key-Insights"><a href="#Key-Insights" class="headerlink" title="Key Insights"></a>Key Insights</h2><ul>
<li>Use <strong>speculation</strong>* to dynamically remove unnecessary lock to improve concurrency.</li>
<li>Misspeculation due to inter-thread data conflicts is detected using existing cache mechanisms and rollback is used for recovery. Successful speculative elision is validated and committed without acquring the lock.</li>
<li>SLE can be implemented entirely in microarchitecture without instruction set support and without system-level modifications (transparent to programmers) and only requires trivial additional hardware support.</li>
<li>For situations where synchronization is required for correctness, they can be detected using cache coherence protocols already implemented in most modern processor.</li>
</ul>
<h2 id="Notable-Design-Details-Strengths"><a href="#Notable-Design-Details-Strengths" class="headerlink" title="Notable Design Details/Strengths"></a>Notable Design Details/Strengths</h2><ul>
<li>Providing <em>appearence of atomicity</em> for each thread in the critical section is done by keep updates are not observed by other threads.</li>
<li>After try times beyond <em>restart threshold</em>, the lock is explicitly acquired.</li>
<li>SLE involves two predictons:<ul>
<li>On a store, predict that another store will shortly follow and undo the changes by this store. If the prediction is validated, the two store are elided.</li>
<li>Predict that all memory operations within the window bounded by the two elided stores occur atomically.</li>
</ul>
</li>
</ul>
<h2 id="Limitations-Weaknesses"><a href="#Limitations-Weaknesses" class="headerlink" title="Limitations/Weaknesses"></a>Limitations/Weaknesses</h2><ul>
<li>How the use cache coherence to guanrantee the order of updates?</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="">
    <link itemprop="mainEntityOfPage" href="https://wshenyi.github.io/2022/01/27/Arch4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.ico">
      <meta itemprop="name" content="Godway">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Godway's Notebook">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/01/27/Arch4/" class="post-title-link" itemprop="url">Computer Architecture - A Quantitative Approach, 6th [C.1 - C.3]</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-01-27 10:17:16" itemprop="dateCreated datePublished" datetime="2022-01-27T10:17:16-05:00">2022-01-27</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-02-18 16:42:55" itemprop="dateModified" datetime="2022-02-18T16:42:55-05:00">2022-02-18</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Architecture/" itemprop="url" rel="index"><span itemprop="name">Architecture</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="C-1-Introduction"><a href="#C-1-Introduction" class="headerlink" title="C.1 Introduction"></a>C.1 Introduction</h2><h2 id=""><a href="#" class="headerlink" title=""></a></h2>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="">
    <link itemprop="mainEntityOfPage" href="https://wshenyi.github.io/2022/01/26/R24/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.ico">
      <meta itemprop="name" content="Godway">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Godway's Notebook">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/01/26/R24/" class="post-title-link" itemprop="url">024 "TriCheck - Memory Model Verification at the Trisection of Software, Hardware, and ISA"</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-01-26 11:17:14" itemprop="dateCreated datePublished" datetime="2022-01-26T11:17:14-05:00">2022-01-26</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-02-16 17:16:48" itemprop="dateModified" datetime="2022-02-16T17:16:48-05:00">2022-02-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Reviews/" itemprop="url" rel="index"><span itemprop="name">Reviews</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><em><strong>Keywards</strong></em> memory model, verification</p>
<blockquote>
<p>Author: Caroline Trippel Yatin A. Manerkar Daniel Lustig Michael,Pellauer Margaret Martonosi</p>
</blockquote>
<hr>
<h2 id="What-is-the-Problem"><a href="#What-is-the-Problem" class="headerlink" title="What is the Problem?"></a>What is the Problem?</h2><p>Many problems can arise when translate a program from a high-level language (HLL) into correct, portable and efficient assembly code.  </p>
<h2 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h2><p>Current verification techniques evaluate segments of the system stack in isolation. This paper makes a case for full-stack MCM verification and provides a toolflow, TriCheck, capable of verifying that the HLL, compiler, ISA, and implementation collectively uphold MCM requirements. This paper demonstrates the necessity of full-stack verification for detecting MCM-related bugs in the hardware-software stack.</p>
<h2 id="Contribution-Key-Results"><a href="#Contribution-Key-Results" class="headerlink" title="Contribution / Key Results"></a>Contribution / Key Results</h2><ul>
<li>Present TriCheck, a framework for full-stack MCM verification</li>
<li>Apply TriCheck to the open-source RISC-V ISA to validate TriCheck’s applicability to modern ISA design.</li>
<li>Use TriCheck to find two conterexamples in the supposedly proven-correct trailing-sync compiler mappings from C11 to the Power and ARMv7 architectures.</li>
</ul>
<h2 id="Key-Insights"><a href="#Key-Insights" class="headerlink" title="Key Insights"></a>Key Insights</h2><p>TriCheck toolflow:</p>
<img src="/2022/01/26/R24/1.png" class="">

<ol>
<li><strong>HLL AXIOMATIC EVALUATION</strong>: The suite ofHLL litmus tests is run on a HLL Herd model (e.g., the C11 Herd model) to determine the outcomes that the HLL MCM <em>permits</em> or <em>forbids</em> for each at the program level.</li>
<li><strong>HLL-&gt;ISA COMPILATION</strong>: Using the HLL-&gt;ISA compiler mappings, TriCheck translates HLL litmus tests to their assembly language equivalents.</li>
<li><strong>ISA $\mu$SPEC EVALUATION</strong>: The suite of assembly litmus tests is run on the Check model of the ISA to determine the outcomes that are <em>observable</em> or <em>unobservable</em> on the microarchitecture.</li>
<li><strong>HLL-MICROARCHITECTURE EQUIVALENCE CHECK</strong>:<ul>
<li>The results of Step 1 and Step 3 are compared for each test to determine if the microarchitecturally realizable out- comes are stronger than, weaker than, or equivalent to the outcomes required by the HLL model. A stronger than (resp. weaker than) outcome corresponds to a HLL pro- gram that is permitted (resp. forbidden) by the HLL MCM, yet unobservable (resp. observable) on the microarchitec- tural implementation of the ISA. If Step 4 concludes that the microarchitecturally realizable outcomes are more re- strictive than what the HLL requires, the designer may wish to relax the ISA or microarchitecture for performance reasons. On the other hand, some correction is mandatory when outcomes forbidden by the HLL are observable on the microarchitecture.</li>
</ul>
</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="">
    <link itemprop="mainEntityOfPage" href="https://wshenyi.github.io/2022/01/24/R22/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.ico">
      <meta itemprop="name" content="Godway">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Godway's Notebook">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/01/24/R22/" class="post-title-link" itemprop="url">022 "Wait-Free Synchronization"</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-01-24 11:04:40" itemprop="dateCreated datePublished" datetime="2022-01-24T11:04:40-05:00">2022-01-24</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-02-16 17:16:34" itemprop="dateModified" datetime="2022-02-16T17:16:34-05:00">2022-02-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Reviews/" itemprop="url" rel="index"><span itemprop="name">Reviews</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><em><strong>Keywards</strong></em> linearizability, wait-free synchronization</p>
<blockquote>
<p>Author: Maurice Herlihy</p>
</blockquote>
<hr>
<h2 id="What-is-the-Problem"><a href="#What-is-the-Problem" class="headerlink" title="What is the Problem?"></a>What is the Problem?</h2><p>The problem of constructing a wait-free implementation of one data object from another lies at the heart of much recent work in concurrent algorithms, concurrent data structures, and multiprocessor architectures.</p>
<h2 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h2><p>A wait-free implementation of a concurrent data object is one tha guarantees that any process can complete any operation in a finite number of steps, regardless of the execution speeds of the other processes. The author proposal many principles and theorems in implementations of a wait-free concurrent data object</p>
<h2 id="Background"><a href="#Background" class="headerlink" title="Background"></a>Background</h2><p>Critical section is a traditional approach to implement <em>concurrent object</em>. However, critical sections are poorly suited for asynchronous, fault-tolerant systems: if a faulty process is halted or delayed in a critical section, nonfaulty process will also be unable to process.</p>
<h2 id="Key-Insights"><a href="#Key-Insights" class="headerlink" title="Key Insights"></a>Key Insights</h2><p>First part:</p>
<ul>
<li><strong>consensus number</strong>: the maximum number of processes for which the object can solve a simple consensus problem.</li>
<li>It is impossible to construct a wait-free implementation of an object with consensus number $n$ <strong>from</strong> an object with a lower consensus number (&lt; n).</li>
<li>Atomic read/write registers are at the bottom of the hierarchy: they can not be used to construct wait-free implementation at higher level.</li>
</ul>
<img src="/2022/01/24/R22/1.png" class="">

<p>Second part:</p>
<ul>
<li>There exist <strong>univeral</strong> objects from which one can construct a wait-free implementation of any other object.</li>
<li>An object is universal in a system of $n$ process if and only if it has a consensus number greater than or equal to $n$.</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="">
    <link itemprop="mainEntityOfPage" href="https://wshenyi.github.io/2022/01/22/R20/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.ico">
      <meta itemprop="name" content="Godway">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Godway's Notebook">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/01/22/R20/" class="post-title-link" itemprop="url">020 "Efficient Synchronization - Let Them Eat QOLB"</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-01-22 15:33:21" itemprop="dateCreated datePublished" datetime="2022-01-22T15:33:21-05:00">2022-01-22</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-02-13 17:20:00" itemprop="dateModified" datetime="2022-02-13T17:20:00-05:00">2022-02-13</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Reviews/" itemprop="url" rel="index"><span itemprop="name">Reviews</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><em><strong>Keywards</strong></em> shared-memory synchronization</p>
<blockquote>
<p>Author: Alain Kägi, Doug Burger, and James R. Goodman</p>
</blockquote>
<hr>
<h2 id="What-is-the-Problem"><a href="#What-is-the-Problem" class="headerlink" title="What is the Problem?"></a>What is the Problem?</h2><p>The act of transferring control of a critical section in a shared-memory system is a trade-off. A complex protocol cause unnecessary delays when accessing a free lock, whereas a simple protocol that can access a free lock quickly may perform poorly in the presence of contention.</p>
<h2 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h2><p>Efficient synchronizatin primitives are essential for achieving high performance in find-gran, shared-memory parallel programs. This paper presents a detailed and thorough evaluation of a range of locking primitives and try to find an optimal combinational locking primitive. The results show that QOLB outperforms all other primitives in all cases.</p>
<h2 id="Key-Insights"><a href="#Key-Insights" class="headerlink" title="Key Insights"></a>Key Insights</h2><ol>
<li>They enumerate the five sources of overhead that locking synchronization primitives can incur.</li>
<li>They describe <strong>four mechanisms</strong> (local spinning, queue-based locking, collocation, and synchronized prefetch) that reduce synchronization overheads.</li>
<li>With detailed simulations, they show the extent to which these four mechanisms can improve the performance of shared-memory programs.</li>
</ol>
<h2 id="Synrohnizaiont-Overhead"><a href="#Synrohnizaiont-Overhead" class="headerlink" title="Synrohnizaiont Overhead"></a>Synrohnizaiont Overhead</h2><p>A complete <em>synchronization period</em> contains three phases.</p>
<ul>
<li><strong>Transfer</strong>: the time at which processor A completes its <em>release</em> of the lock to the time processor B completes its <em>acquire</em>.</li>
<li><strong>Load/Compute</strong>: the time at which processor B completes its lock <em>acquire</em> to the time processor B issues its lock <em>release</em>.</li>
<li><strong>release</strong>: the time from processor B issuing the lock <em>release</em> to the completion of the lock <em>release</em>.</li>
</ul>
<img src="/2022/01/22/R20/1.png" class="">

<h2 id="Synchronization-Mechanisms"><a href="#Synchronization-Mechanisms" class="headerlink" title="Synchronization Mechanisms"></a>Synchronization Mechanisms</h2><p>Four mechanisms that locks may incorperate to reduce the time spent in a synchronization period.</p>
<ul>
<li><strong>local spinning</strong>: greatly reduce the load on the network, particularly for longer crit- ical sections.</li>
<li><strong>queue-based locking</strong>: eliminates arbitration overhead and reduces lock transfer time, both in the <em>Transfer</em> phase.</li>
<li><strong>collocation</strong>: eliminates read and write overheads in the Load/Store phase. (lets protected data be transferred with the transfer of the lock itself.)</li>
<li><strong>synthronious prefetch</strong>: reduce lock transfer latency when the lock holder release the lock early than requester request that lock.</li>
</ul>
<img src="/2022/01/22/R20/2.png" class="">

<h2 id="Synchronization-primitives"><a href="#Synchronization-primitives" class="headerlink" title="Synchronization primitives"></a>Synchronization primitives</h2><p>Six primitives:</p>
<ul>
<li><strong>TEST&amp;SET</strong> (TS)</li>
<li><strong>TEST&amp;TEST&amp;SET</strong> (TTS)</li>
<li><strong>LH locks</strong></li>
<li><strong>M locks</strong></li>
<li><strong>MCS locks</strong></li>
<li><strong>QOLB</strong></li>
</ul>
<img src="/2022/01/22/R20/3.png" class="">

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="">
    <link itemprop="mainEntityOfPage" href="https://wshenyi.github.io/2022/01/21/Arch3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.ico">
      <meta itemprop="name" content="Godway">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Godway's Notebook">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/01/21/Arch3/" class="post-title-link" itemprop="url">Computer Architecture - A Quantitative Approach, 6th [A.6 - A.9]</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-01-21 10:05:01" itemprop="dateCreated datePublished" datetime="2022-01-21T10:05:01-05:00">2022-01-21</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-02-18 16:42:37" itemprop="dateModified" datetime="2022-02-18T16:42:37-05:00">2022-02-18</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Architecture/" itemprop="url" rel="index"><span itemprop="name">Architecture</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>Author: John L. Hennessy, David A. Patterson</p>
</blockquote>
<p>Chapter A: Instruction Set Principles</p>
<hr>
<h2 id="A-6-Instuctions-for-Control-Flow"><a href="#A-6-Instuctions-for-Control-Flow" class="headerlink" title="A.6 Instuctions for Control Flow"></a>A.6 Instuctions for Control Flow</h2><p>Throughout this book we will use <strong>jump</strong> when the change in control is unconditional and <strong>branch</strong> when the change is conditional.</p>
<p>Four types of control flow change:</p>
<ul>
<li>Conditional branches</li>
<li>Jumps</li>
<li>Procedure calls</li>
<li>Procedure returns</li>
</ul>
<h3 id="Addressing-Modes-for-Control-Flow-Instructions"><a href="#Addressing-Modes-for-Control-Flow-Instructions" class="headerlink" title="Addressing Modes for Control Flow Instructions"></a>Addressing Modes for Control Flow Instructions</h3><p>The destination address of a control flow instruction must always be specified. This destination is specified explicitly in the instruction in the vast majority of cases -— procedure return being the major exception, because for return the target is not known at compile time.</p>
<ul>
<li><strong>PC-relative addressing</strong>: the target address is already know at compile time<ul>
<li>Specify the destination by suppling a displacement that is added to the <em>program counter</em> (PC).</li>
<li>PC-relative branches or jumps are advantageous because the target is often near the current instruction, and specifying the position relative to the current PC requires fewer bits.</li>
<li>Using PC-relative addressing also permits the code to run independently of where it is loaded. This property, called position independence, can eliminate some work when the program is linked and is also useful in programs linked dynamically during execution.</li>
</ul>
</li>
<li><strong>Dynamic addressing</strong>: the target address is unknown at compile time<ul>
<li>Specify the destination by naming a register that contains the target address. (store the address in memory and load it to a register when needed)</li>
<li>Procedure returns are the major cases.</li>
</ul>
</li>
</ul>
<p>These register indirect jumps also useful for:</p>
<ul>
<li>Case or switch statements</li>
<li>Virtual functions or methods in object-oriented languages</li>
<li>High-order functions or function pointers</li>
<li>Dynamically shared libraries</li>
</ul>
<h3 id="Conditional-Branch-Options"><a href="#Conditional-Branch-Options" class="headerlink" title="Conditional Branch Options"></a>Conditional Branch Options</h3><p>Because most changes in control flow are branches, deciding how to specify the branch condition is important.</p>
<img src="/2022/01/21/Arch3/1.png" class="">

<h3 id="Procedure-Invocation-Options"><a href="#Procedure-Invocation-Options" class="headerlink" title="Procedure Invocation Options"></a>Procedure Invocation Options</h3><p>Procedure calls and returns include control transfer and possibly some state saving; at a minimum the return address must be saved somewhere, sometimes in a special link register or just a GPR.</p>
<p>There are two basic conventions in use to save registers: </p>
<ul>
<li>Caller saving: the calling procedure must save the registers it wants preserved.</li>
<li>Callee saving: the called procedure must save the registers it wants to use.</li>
</ul>
<p>Most real systems today use a combination of the two mechanisms. This convention is specified in an application binary interface (<strong>ABI</strong>).</p>
<h2 id="A-7-Encoding-an-Instruction-Set"><a href="#A-7-Encoding-an-Instruction-Set" class="headerlink" title="A.7 Encoding an Instruction Set"></a>A.7 Encoding an Instruction Set</h2><h2 id="A-8-The-Role-of-Compilers"><a href="#A-8-The-Role-of-Compilers" class="headerlink" title="A.8 The Role of Compilers"></a>A.8 The Role of Compilers</h2><h2 id=""><a href="#" class="headerlink" title=""></a></h2>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/7/">7</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Godway"
      src="/images/avatar.ico">
  <p class="site-author-name" itemprop="name">Godway</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">66</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">12</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="/475865836@qq.com" title="E-Mail → 475865836@qq.com"><i class="envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://randool.cn/" title="https:&#x2F;&#x2F;randool.cn" rel="noopener" target="_blank">Randool</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://me.csdn.net/Smile_coderrr" title="https:&#x2F;&#x2F;me.csdn.net&#x2F;Smile_coderrr" rel="noopener" target="_blank">Smile_coderrr</a>
        </li>
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Godway</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a>
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  
  <script>
    (function(){
      var canonicalURL, curProtocol;
      //Get the <link> tag
      var x=document.getElementsByTagName("link");
		//Find the last canonical URL
		if(x.length > 0){
			for (i=0;i<x.length;i++){
				if(x[i].rel.toLowerCase() == 'canonical' && x[i].href){
					canonicalURL=x[i].href;
				}
			}
		}
    //Get protocol
	    if (!canonicalURL){
	    	curProtocol = window.location.protocol.split(':')[0];
	    }
	    else{
	    	curProtocol = canonicalURL.split(':')[0];
	    }
      //Get current URL if the canonical URL does not exist
	    if (!canonicalURL) canonicalURL = window.location.href;
	    //Assign script content. Replace current URL with the canonical URL
      !function(){var e=/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi,r=canonicalURL,t=document.referrer;if(!e.test(r)){var n=(String(curProtocol).toLowerCase() === 'https')?"https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif":"//api.share.baidu.com/s.gif";t?(n+="?r="+encodeURIComponent(document.referrer),r&&(n+="&l="+r)):r&&(n+="?l="+r);var i=new Image;i.src=n}}(window);})();
  </script>















  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  

</body>
</html>
